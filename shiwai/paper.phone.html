<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>PDF.js 在线查看</title>

  <!-- Tailwind CSS（可选） -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF.js 核心脚本 + worker -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.6.172/build/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.6.172/build/pdf.worker.min.js';
  </script>

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f5f7fa;
      font-family: sans-serif;
    }
    .pdf-container {
      max-width: 600px; /* 控制最大宽度，超出后居中 */
      margin: 0 auto;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      border-radius: 4px;
      text-align: center;
      padding-bottom: 1rem;
    }
    canvas {
      display: block;
      margin: 0 auto;
      width: 100%; /* 让 canvas 宽度自适应容器 */
      height: auto;
    }
    .nav-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
    }
    button {
      padding: 0.5rem 1rem;
      background: #16a34a;
      color: #fff;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #22c55e;
    }
    .page-info {
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>

  <div class="pdf-container">
    <div class="nav-buttons">
      <button onclick="prevPage()">上一页</button>
      <button onclick="nextPage()">下一页</button>
    </div>
    <!-- 页码信息 -->
    <div class="page-info">
      第 <span id="pageNum">1</span> 页 / 共 <span id="pageCount">1</span> 页
    </div>
    <!-- 用于显示 PDF 内容的 canvas -->
    <canvas id="pdfCanvas"></canvas>
  </div>

  <script>
    let pdfDoc = null;       // PDF Document
    let pageNum = 1;         // 当前页码
    let totalPages = 1;      // 总页数
    const canvas = document.getElementById('pdfCanvas');
    const ctx = canvas.getContext('2d');

    // ====== 关键：让 PDF 在高 DPI (Retina) 屏幕上更清晰 ======
    // 通过乘以 window.devicePixelRatio 来放大实际渲染分辨率
    function getRenderViewport(page, containerWidth) {
      // 获取 PDF 原始宽度
      const viewport = page.getViewport({ scale: 1 });
      // 根据容器宽度计算基本缩放比
      let scale = containerWidth / viewport.width;
      // 乘以设备像素比
      const dpr = window.devicePixelRatio || 1;
      scale = scale * dpr;

      return page.getViewport({ scale: scale });
    }

    // 加载 PDF
    async function loadPDF(url) {
      try {
        pdfDoc = await pdfjsLib.getDocument(url).promise;
        totalPages = pdfDoc.numPages;
        document.getElementById('pageCount').textContent = totalPages;
        pageNum = 1;
        renderPage(pageNum);
      } catch (e) {
        console.error('PDF 加载失败：', e);
      }
    }

    // 渲染指定页
    async function renderPage(num) {
      if (!pdfDoc) return;
      const page = await pdfDoc.getPage(num);

      // 计算容器宽度（此处容器就是 pdf-container）
      const containerWidth = document.querySelector('.pdf-container').clientWidth;
      // 获取适应屏幕并乘以 devicePixelRatio 的 viewport
      const viewport = getRenderViewport(page, containerWidth);

      // 按实际渲染尺寸设置 canvas 大小
      canvas.width = viewport.width;
      canvas.height = viewport.height;

      // 但要注意：CSS 宽度我们依然让 canvas 100% 撑满容器
      // 这样视觉上不会变形
      canvas.style.width = (viewport.width / (window.devicePixelRatio || 1)) + 'px';
      canvas.style.height = (viewport.height / (window.devicePixelRatio || 1)) + 'px';

      // 渲染到 canvas
      await page.render({
        canvasContext: ctx,
        viewport: viewport
      }).promise;

      // 更新页码显示
      pageNum = num;
      document.getElementById('pageNum').textContent = num;
    }

    // 上一页
    function prevPage() {
      if (!pdfDoc || pageNum <= 1) return;
      renderPage(--pageNum);
    }
    // 下一页
    function nextPage() {
      if (!pdfDoc || pageNum >= totalPages) return;
      renderPage(++pageNum);
    }

    // ========== 示例：初始化时加载某个 PDF 文件 ==========
    // 你可以在外部通过 URL 带参 或者改成你想要的 PDF 路径
    loadPDF('/shiwai/pdf/评分-浑南智能车实验室竞速组招新考核评分标准（视觉组）.pdf');
  </script>
</body>
</html>